# 프롬프트 수정 문제 해결 가이드

## 문제점
1. 프롬프트 수정 시 "이름, 역할 등이 필수"라는 에러가 발생
2. 실제로는 모든 필수 값이 입력되어 있음에도 에러 발생
3. 프론트엔드와 백엔드 간의 데이터 전송 문제

## 원인 분석
1. **StableTextField 컴포넌트의 값 동기화 문제**
   - ref를 통한 값 전달이 제대로 되지 않음
   - 컴포넌트 내부 상태와 외부 전달 값의 불일치

2. **백엔드 필수 필드 검증 로직**
   - 수정 시 전송되지 않은 필드는 기존 값을 유지해야 함
   - 빈 문자열 처리 로직 부재

3. **프론트엔드 데이터 전송 방식**
   - 변경된 필드만 전송하려다 필수 필드 누락 가능성

## 해결 방법

### 1. 백엔드 수정
#### `/backend/app/services/prompt_service.py`
```python
def update_prompt(self, prompt_id: str, request: PromptUpdateRequest) -> Optional[PromptTemplate]:
    # 기존 데이터 업데이트 - 빈 문자열도 허용
    # 필수 필드 검증은 수정 후에 확인
```

#### `/backend/app/api/endpoints/prompts.py`
```python
# 현재 프롬프트 가져오기
existing_prompt = prompt_service.get_prompt_by_id(prompt_id)
# 업데이트 요청에 필드가 없으면 기존 값 유지
final_name = request.name if request.name is not None else existing_prompt.name
```

### 2. 프론트엔드 수정
#### `/frontend/src/pages/PromptsPage.js`
```javascript
// 수정 모드에서도 모든 필드를 전송 (백엔드에서 필터링)
response = await promptService.updatePrompt(currentPrompt.id, currentFormData);

// 응답 확인
if (response.success === false) {
    showAlert(response.message || '프롬프트 저장에 실패했습니다.', 'error');
    return;
}
```

### 3. 스키마 개선
#### `/backend/app/models/schemas.py`
```python
class PromptCreateRequest(BaseModel):
    name: str = Field(..., min_length=1, description="프롬프트 이름 (필수)")
    role_definition: str = Field(..., min_length=1, description="역할 정의 (필수)")
    base_prompt: str = Field(..., min_length=1, description="기본 프롬프트 (필수)")
    # 선택 필드는 기본값 ""로 설정
    detailed_instructions: str = Field("", description="상세 지침")
```

## 테스트 방법
1. 백엔드 서버 재시작
   ```bash
   cd backend
   python run.py
   ```

2. 프론트엔드 서버 재시작
   ```bash
   cd frontend
   npm start
   ```

3. 테스트 스크립트 실행
   ```bash
   python test_prompt_update.py
   ```

## 예상 결과
- 프롬프트 수정 시 에러 없이 정상 동작
- 필수 필드만 입력해도 수정 가능
- 빈 문자열 입력 시에도 정상 처리
- 명확한 에러 메시지 표시

## 추가 개선사항
1. 프론트엔드 폼 검증 강화
2. 실시간 필드 검증 추가
3. 에러 메시지 상세화
4. 로딩 상태 표시 개선
